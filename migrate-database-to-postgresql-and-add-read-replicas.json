{"name":"Database_Migration_to_PostgreSQL_with_Read_Replicas","description":"A state machine plan to migrate an existing database to PostgreSQL and configure read replicas, including interactive user input and tool calls.","start":"Start_Migration","steps":[{"id":"Start_Migration","title":"Initialize Migration","type":"action","instructions":"Beginning the database migration process to PostgreSQL with read replicas.","transitions":[{"condition":"always","next":"Query_Current_DB_Details"}]},{"id":"Query_Current_DB_Details","title":"Gather Source DB Information","type":"ask_user","instructions":"Please provide details about your current database: What is its type (e.g., MySQL, SQL Server, Oracle)? What is its approximate size (e.g., 100GB, 1TB)? Where is it currently hosted (e.g., AWS RDS, On-premise, Azure DB)?","transitions":[{"condition":"user_provided_details","next":"Select_Migration_Strategy"},{"condition":"user_aborted","next":"Migration_Failed"}]},{"id":"Select_Migration_Strategy","title":"Determine Migration Strategy","type":"decide","instructions":"Based on the provided source database details (type, size, hosting), determine the most suitable migration strategy (e.g., logical replication, dump/restore, cloud-native migration service like AWS DMS).","transitions":[{"condition":"strategy_identified","next":"Provision_PostgreSQL_DB"},{"condition":"more_info_needed","next":"Query_Current_DB_Details"},{"condition":"no_viable_strategy","next":"Migration_Failed"}]},{"id":"Provision_PostgreSQL_DB","title":"Provision Target PostgreSQL Instance","type":"call_tool","instructions":"Provision a new PostgreSQL database instance in the target environment, configured according to the migration strategy and source database requirements.","tool":{"name":"provision_database_instance","args":{"db_type":"PostgreSQL","instance_size":"determined_by_strategy","region":"determined_by_strategy","version":"latest_stable"}},"transitions":[{"condition":"provisioning_successful","next":"Perform_Data_Migration"},{"condition":"provisioning_failed","next":"Handle_Provisioning_Failure"}]},{"id":"Perform_Data_Migration","title":"Execute Data Migration","type":"call_tool","instructions":"Initiate the data migration process from the source database to the newly provisioned PostgreSQL instance using the selected strategy.","tool":{"name":"execute_db_migration","args":{"source_db_connection":"source_details","target_db_connection":"target_details","migration_strategy":"selected_strategy"}},"transitions":[{"condition":"migration_successful","next":"Verify_Data_Integrity"},{"condition":"migration_failed","next":"Handle_Data_Migration_Failure"}]},{"id":"Verify_Data_Integrity","title":"Validate Migrated Data","type":"action","instructions":"Perform checks to ensure data integrity and completeness after migration. This may involve row counts, checksums, and application-level tests.","transitions":[{"condition":"data_valid","next":"Configure_Read_Replicas"},{"condition":"data_invalid","next":"Handle_Data_Validation_Failure"}]},{"id":"Configure_Read_Replicas","title":"Set Up Read Replicas","type":"call_tool","instructions":"Configure and provision one or more read replicas for the primary PostgreSQL instance to enhance read scalability and availability.","tool":{"name":"configure_read_replicas","args":{"primary_db_instance_id":"primary_db_id","number_of_replicas":2,"replica_type":"streaming"}},"transitions":[{"condition":"replicas_configured_successfully","next":"Validate_Read_Replicas"},{"condition":"replica_configuration_failed","next":"Handle_Replica_Config_Failure"}]},{"id":"Validate_Read_Replicas","title":"Test Read Replicas Functionality","type":"action","instructions":"Verify that the read replicas are synchronized with the primary database and are correctly serving read queries.","transitions":[{"condition":"replicas_functional","next":"Migration_Successful"},{"condition":"replicas_not_functional","next":"Handle_Replica_Validation_Failure"}]},{"id":"Handle_Provisioning_Failure","title":"Provisioning Error","type":"action","instructions":"Failed to provision the PostgreSQL instance. Review logs for details. Do you want to retry or abort?","transitions":[{"condition":"user_retry","next":"Provision_PostgreSQL_DB"},{"condition":"user_abort","next":"Migration_Failed"}]},{"id":"Handle_Data_Migration_Failure","title":"Data Migration Error","type":"action","instructions":"The data migration process encountered an error. Review logs for details. Do you want to retry or abort?","transitions":[{"condition":"user_retry","next":"Perform_Data_Migration"},{"condition":"user_abort","next":"Migration_Failed"}]},{"id":"Handle_Data_Validation_Failure","title":"Data Validation Error","type":"action","instructions":"Data integrity checks failed after migration. There might be data loss or corruption. Do you want to re-validate, re-migrate, or abort?","transitions":[{"condition":"user_revalidate","next":"Verify_Data_Integrity"},{"condition":"user_remigrate","next":"Perform_Data_Migration"},{"condition":"user_abort","next":"Migration_Failed"}]},{"id":"Handle_Replica_Config_Failure","title":"Read Replica Configuration Error","type":"action","instructions":"Failed to configure read replicas. Review logs for details. Do you want to retry or abort?","transitions":[{"condition":"user_retry","next":"Configure_Read_Replicas"},{"condition":"user_abort","next":"Migration_Failed"}]},{"id":"Handle_Replica_Validation_Failure","title":"Read Replica Validation Error","type":"action","instructions":"Read replicas are not functioning correctly or are out of sync. Review logs for details. Do you want to re-validate, reconfigure, or abort?","transitions":[{"condition":"user_revalidate","next":"Validate_Read_Replicas"},{"condition":"user_reconfigure","next":"Configure_Read_Replicas"},{"condition":"user_abort","next":"Migration_Failed"}]},{"id":"Migration_Successful","title":"Migration Complete","type":"action","instructions":"The database has been successfully migrated to PostgreSQL, and read replicas are configured and validated. The process is complete.","transitions":[]},{"id":"Migration_Failed","title":"Migration Aborted/Failed","type":"action","instructions":"The database migration process was aborted or encountered an unrecoverable error. Please review previous steps for details.","transitions":[]}]}